(()=>{var e={};e.id=371,e.ids=[371],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},431:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>o,pages:()=>m,routeModule:()=>u,tree:()=>c}),s(4846),s(2029),s(5866);var a=s(3191),l=s(8716),r=s(7922),i=s.n(r),n=s(5231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);s.d(t,d);let c=["",{children:["sales",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4846)),"D:\\sistema-auto-pecas\\src\\app\\sales\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"D:\\sistema-auto-pecas\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],m=["D:\\sistema-auto-pecas\\src\\app\\sales\\page.tsx"],o="/sales/page",x={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/sales/page",pathname:"/sales",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1403:(e,t,s)=>{Promise.resolve().then(s.bind(s,2310))},2310:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var a=s(326),l=s(7577),r=s(226),i=s(9837),n=s(9175),d=s(2102),c=s(5330),m=s(1223),o=s(3855),x=s(7671);let u=(0,s(6557).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var p=s(8091);function h(){let[e,t]=(0,l.useState)([]),[s,h]=(0,l.useState)([]),[g,j]=(0,l.useState)(null),[y,N]=(0,l.useState)(!0),[v,f]=(0,l.useState)(!1),[b,w]=(0,l.useState)(!1),[C,P]=(0,l.useState)(null),[E,k]=(0,l.useState)({search:"",status:"",paymentMethod:""}),[D,S]=(0,l.useState)({customerName:"",customerEmail:"",customerPhone:"",customerDocument:"",discount:"",paymentMethod:"",notes:"",items:[]}),[I,_]=(0,l.useState)({}),[A,q]=(0,l.useState)(""),[z,M]=(0,l.useState)(1),[T,G]=(0,l.useState)(""),R=async()=>{try{let[e,s,a]=await Promise.all([fetch(`/api/sales?${new URLSearchParams(E)}`),fetch("/api/parts?limit=1000"),fetch("/api/auth/me")]);if(e.ok){let s=await e.json();t(s.data)}if(s.ok){let e=await s.json();h(e.data.filter(e=>e.stock>0))}if(a.ok){let e=await a.json();j(e.data)}}catch(e){console.error("Error fetching data:",e)}finally{N(!1)}},F=async e=>{if(e.preventDefault(),_({}),0===D.items.length){_({general:"Adicione pelo menos um item \xe0 venda"});return}try{let e=await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D)}),t=await e.json();e.ok?(f(!1),O(),R()):_({general:t.error||"Erro ao criar venda"})}catch(e){_({general:"Erro de conex\xe3o"})}},V=e=>{S(t=>({...t,items:t.items.filter((t,s)=>s!==e)}))},O=()=>{S({customerName:"",customerEmail:"",customerPhone:"",customerDocument:"",discount:"",paymentMethod:"",notes:"",items:[]}),_({}),q(""),M(1),G("")},$=e=>{S(t=>({...t,[e.target.name]:e.target.value}))},L=e=>{P(e),w(!0)};if(y)return a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});let Z=[{value:"CASH",label:"Dinheiro"},{value:"CREDIT_CARD",label:"Cart\xe3o de Cr\xe9dito"},{value:"DEBIT_CARD",label:"Cart\xe3o de D\xe9bito"},{value:"PIX",label:"PIX"},{value:"BANK_TRANSFER",label:"Transfer\xeancia"},{value:"CHECK",label:"Cheque"}];return a.jsx(r.A,{user:g,children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Vendas"}),a.jsx("p",{className:"text-gray-600",children:"Gerencie as vendas e or\xe7amentos"})]}),(0,a.jsxs)(i.z,{onClick:()=>f(!0),children:[a.jsx(o.Z,{className:"w-4 h-4 mr-2"}),"Nova Venda"]})]}),a.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(n.I,{placeholder:"Buscar vendas...",value:E.search,onChange:e=>k(t=>({...t,search:e.target.value}))}),a.jsx(d.P,{options:[{value:"PENDING",label:"Pendente"},{value:"CONFIRMED",label:"Confirmado"},{value:"DELIVERED",label:"Entregue"},{value:"CANCELLED",label:"Cancelado"}],value:E.status,onChange:e=>k(t=>({...t,status:e.target.value}))}),a.jsx(d.P,{options:Z,value:E.paymentMethod,onChange:e=>k(t=>({...t,paymentMethod:e.target.value}))})]})}),a.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Venda"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),a.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A\xe7\xf5es"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,a.jsxs)("tr",{className:"table-row",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(x.Z,{className:"w-8 h-8 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:["#",e.saleNumber]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.items.length," itens"]})]})]})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[a.jsx("div",{className:"text-sm text-gray-900",children:e.customerName||"Cliente n\xe3o informado"}),e.customerPhone&&a.jsx("div",{className:"text-sm text-gray-500",children:e.customerPhone})]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,m.xG)(Number(e.total))}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(0,m.z2)(e.status)}`,children:(0,m.li)(e.status)})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,m.o0)(e.createdAt)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:a.jsx(i.z,{variant:"outline",size:"sm",onClick:()=>L(e),children:a.jsx(u,{className:"w-4 h-4"})})})]},e.id))})]})})}),a.jsx(c.u,{isOpen:v,onClose:()=>{f(!1),O()},title:"Nova Venda",size:"xl",children:(0,a.jsxs)("form",{onSubmit:F,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Dados do Cliente"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(n.I,{label:"Nome",name:"customerName",value:D.customerName,onChange:$}),a.jsx(n.I,{label:"Email",name:"customerEmail",type:"email",value:D.customerEmail,onChange:$}),a.jsx(n.I,{label:"Telefone",name:"customerPhone",value:D.customerPhone,onChange:$}),a.jsx(n.I,{label:"CPF/CNPJ",name:"customerDocument",value:D.customerDocument,onChange:$})]})]}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Itens da Venda"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(d.P,{label:"Pe\xe7a",options:s.map(e=>({value:e.id,label:`${e.name} (${e.code}) - Estoque: ${e.stock}`})),value:A,onChange:e=>{q(e.target.value);let t=s.find(t=>t.id===e.target.value);t&&G(t.price.toString())}}),a.jsx(n.I,{label:"Quantidade",type:"number",min:"1",value:z,onChange:e=>M(parseInt(e.target.value))}),a.jsx(n.I,{label:"Pre\xe7o",type:"number",step:"0.01",value:T,onChange:e=>G(e.target.value)}),a.jsx("div",{className:"flex items-end",children:a.jsx(i.z,{type:"button",onClick:()=>{if(!A||!T)return;let e=s.find(e=>e.id===A);if(!e)return;if(z>e.stock){_({item:"Quantidade maior que o estoque dispon\xedvel"});return}let t={partId:A,quantity:z,price:parseFloat(T),discount:0};S(e=>({...e,items:[...e.items,t]})),q(""),M(1),G(""),_({})},className:"w-full",children:"Adicionar"})})]}),I.item&&a.jsx("p",{className:"text-red-600 text-sm mt-2",children:I.item})]}),D.items.length>0&&a.jsx("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Pe\xe7a"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Qtd"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Pre\xe7o"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),a.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"A\xe7\xf5es"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:D.items.map((e,t)=>{let l=s.find(t=>t.id===e.partId);return(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900",children:[l?.name," (",l?.code,")"]}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:e.quantity}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:(0,m.xG)(e.price)}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:(0,m.xG)(e.quantity*e.price)}),a.jsx("td",{className:"px-4 py-2 text-right",children:a.jsx(i.z,{type:"button",variant:"danger",size:"sm",onClick:()=>V(t),children:a.jsx(p.Z,{className:"w-4 h-4"})})})]},t)})})]})})]}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Pagamento"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(n.I,{label:"Desconto",name:"discount",type:"number",step:"0.01",value:D.discount,onChange:$}),a.jsx(d.P,{label:"Forma de Pagamento",name:"paymentMethod",options:Z,value:D.paymentMethod,onChange:$})]}),a.jsx("div",{className:"mt-4",children:a.jsx(n.I,{label:"Observa\xe7\xf5es",name:"notes",value:D.notes,onChange:$})})]}),a.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.jsx("div",{className:"text-right",children:(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["Total: ",(0,m.xG)(D.items.reduce((e,t)=>e+(t.quantity*t.price-(t.discount||0)),0)-(parseFloat(D.discount)||0))]})})}),I.general&&a.jsx("div",{className:"text-red-600 text-sm",children:I.general}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[a.jsx(i.z,{type:"button",variant:"secondary",onClick:()=>{f(!1),O()},children:"Cancelar"}),a.jsx(i.z,{type:"submit",children:"Criar Venda"})]})]})}),a.jsx(c.u,{isOpen:b,onClose:()=>{w(!1),P(null)},title:`Venda #${C?.saleNumber}`,size:"lg",children:C&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Dados do Cliente"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:"Nome:"})," ",C.customerName||"N\xe3o informado"]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:"Email:"})," ",C.customerEmail||"N\xe3o informado"]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:"Telefone:"})," ",C.customerPhone||"N\xe3o informado"]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:"Status:"})," ",a.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(0,m.z2)(C.status)}`,children:(0,m.li)(C.status)})]})]})]}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Itens"}),a.jsx("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Pe\xe7a"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Qtd"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Pre\xe7o"}),a.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:C.items.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900",children:[e.part.name," (",e.part.code,")"]}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:e.quantity}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:(0,m.xG)(Number(e.price))}),a.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:(0,m.xG)(Number(e.total))})]},e.id))})]})})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:"Forma de Pagamento:"})," ",C.paymentMethod?(0,m.vw)(C.paymentMethod):"N\xe3o informado"]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium",children:"Data:"})," ",(0,m.o0)(C.createdAt)]})]}),a.jsx("div",{className:"mt-4 text-right",children:(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["Total: ",(0,m.xG)(Number(C.total))]})})]})]})})]})})}},2102:(e,t,s)=>{"use strict";s.d(t,{P:()=>r});var a=s(326);s(7577);var l=s(1223);let r=({label:e,error:t,helperText:s,options:r,className:i,id:n,...d})=>{let c=n||e?.toLowerCase().replace(/\s+/g,"-");return(0,a.jsxs)("div",{className:"space-y-1",children:[e&&a.jsx("label",{htmlFor:c,className:"block text-sm font-medium text-gray-700",children:e}),(0,a.jsxs)("select",{id:c,className:(0,l.cn)("input-field",t&&"border-red-300 focus:ring-red-500",i),...d,children:[a.jsx("option",{value:"",children:"Selecione..."}),r.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))]}),t&&a.jsx("p",{className:"text-sm text-red-600",children:t}),s&&!t&&a.jsx("p",{className:"text-sm text-gray-500",children:s})]})}},4846:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`D:\sistema-auto-pecas\src\app\sales\page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,349,581,795],()=>s(431));module.exports=a})();