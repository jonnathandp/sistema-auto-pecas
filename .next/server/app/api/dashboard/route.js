"use strict";(()=>{var e={};e.id=707,e.ids=[707],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},19872:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var r={};a.r(r),a.d(r,{GET:()=>l,dynamic:()=>u,revalidate:()=>d});var s=a(49303),o=a(88716),n=a(60670),i=a(87070);let u="force-dynamic",d=0;async function l(){try{if("build"===process.env.VERCEL_ENV||!process.env.DATABASE_URL)return i.NextResponse.json({totalParts:0,totalSales:0,totalRevenue:0,lowStockParts:[],recentSales:[],monthlyRevenue:[]});let{PrismaClient:e}=await Promise.resolve().then(a.t.bind(a,53524,23)),t=new e;try{let[e,a,r,s]=await Promise.all([t.part.count({where:{isActive:!0}}),t.sale.count(),t.sale.aggregate({_sum:{total:!0}}),t.part.count({where:{isActive:!0,stock:{lte:t.part.fields.minStock}}})]),o=await t.sale.findMany({take:5,orderBy:{createdAt:"desc"},include:{items:{include:{part:!0}},user:{select:{name:!0}}}}),n=await t.saleItem.groupBy({by:["partId"],_sum:{quantity:!0,total:!0},orderBy:{_sum:{quantity:"desc"}},take:5}),u=await Promise.all(n.map(async e=>({part:await t.part.findUnique({where:{id:e.partId}}),totalSold:e._sum.quantity||0,revenue:e._sum.total||0}))),d=new Date;d.setMonth(d.getMonth()-6);let l=(await t.sale.groupBy({by:["createdAt"],where:{createdAt:{gte:d}},_count:{id:!0},_sum:{total:!0}})).reduce((e,t)=>{let a=new Date(t.createdAt).toLocaleDateString("pt-BR",{year:"numeric",month:"short"});return e[a]||(e[a]={sales:0,revenue:0}),e[a].sales+=t._count.id,e[a].revenue+=Number(t._sum.total||0),e},{}),c=Object.entries(l).map(([e,t])=>({month:e,sales:t.sales,revenue:t.revenue}));return await t.$disconnect(),i.NextResponse.json({success:!0,data:{totalParts:e,totalSales:a,totalRevenue:Number(r._sum.total||0),lowStockParts:s,recentSales:o,topSellingParts:u,salesByMonth:c}})}catch(e){throw await t.$disconnect(),e}}catch(e){return console.error("Dashboard error:",e),i.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/dashboard/route",pathname:"/api/dashboard",filename:"route",bundlePath:"app/api/dashboard/route"},resolvedPagePath:"D:\\sistema-auto-pecas\\src\\app\\api\\dashboard\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:h}=c,v="/api/dashboard/route";function y(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(19872));module.exports=r})();