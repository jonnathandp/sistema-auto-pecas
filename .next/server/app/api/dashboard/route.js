"use strict";(()=>{var e={};e.id=707,e.ids=[707,538],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9872:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var r={};a.r(r),a.d(r,{GET:()=>p});var s=a(9303),o=a(8716),i=a(670),n=a(7070),u=a(3538);async function p(){try{let[e,t,a,r]=await Promise.all([u.prisma.part.count({where:{isActive:!0}}),u.prisma.sale.count(),u.prisma.sale.aggregate({_sum:{total:!0}}),u.prisma.part.count({where:{isActive:!0,stock:{lte:u.prisma.part.fields.minStock}}})]),s=await u.prisma.sale.findMany({take:5,orderBy:{createdAt:"desc"},include:{items:{include:{part:!0}},user:{select:{name:!0}}}}),o=await u.prisma.saleItem.groupBy({by:["partId"],_sum:{quantity:!0,total:!0},orderBy:{_sum:{quantity:"desc"}},take:5}),i=await Promise.all(o.map(async e=>({part:await u.prisma.part.findUnique({where:{id:e.partId}}),totalSold:e._sum.quantity||0,revenue:e._sum.total||0}))),p=new Date;p.setMonth(p.getMonth()-6);let d=(await u.prisma.sale.groupBy({by:["createdAt"],where:{createdAt:{gte:p}},_count:{id:!0},_sum:{total:!0}})).reduce((e,t)=>{let a=new Date(t.createdAt).toLocaleDateString("pt-BR",{year:"numeric",month:"short"});return e[a]||(e[a]={sales:0,revenue:0}),e[a].sales+=t._count.id,e[a].revenue+=Number(t._sum.total||0),e},{}),l=Object.entries(d).map(([e,t])=>({month:e,sales:t.sales,revenue:t.revenue}));return n.NextResponse.json({success:!0,data:{totalParts:e,totalSales:t,totalRevenue:Number(a._sum.total||0),lowStockParts:r,recentSales:s,topSellingParts:i,salesByMonth:l}})}catch(e){return console.error("Dashboard error:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/dashboard/route",pathname:"/api/dashboard",filename:"route",bundlePath:"app/api/dashboard/route"},resolvedPagePath:"D:\\sistema-auto-pecas\\src\\app\\api\\dashboard\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:m}=d,h="/api/dashboard/route";function v(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},3538:(e,t,a)=>{a.d(t,{prisma:()=>s});var r=a(3524);let s=globalThis.prisma??new r.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(9872));module.exports=r})();