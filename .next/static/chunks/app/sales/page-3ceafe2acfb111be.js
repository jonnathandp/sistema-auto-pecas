(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{2450:function(e,t,s){Promise.resolve().then(s.bind(s,2311))},2311:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var a=s(7437),l=s(2265),i=s(3207),r=s(6334),n=s(2827),d=s(6819),c=s(3008),m=s(3448),x=s(9397),o=s(6275);let h=(0,s(9763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var u=s(8930);function p(){let[e,t]=(0,l.useState)([]),[s,p]=(0,l.useState)([]),[g,j]=(0,l.useState)(null),[y,N]=(0,l.useState)(!0),[v,f]=(0,l.useState)(!1),[b,w]=(0,l.useState)(!1),[C,P]=(0,l.useState)(null),[E,k]=(0,l.useState)({search:"",status:"",paymentMethod:""}),[S,D]=(0,l.useState)({customerName:"",customerEmail:"",customerPhone:"",customerDocument:"",discount:"",paymentMethod:"",notes:"",items:[]}),[I,z]=(0,l.useState)({}),[A,T]=(0,l.useState)(""),[M,q]=(0,l.useState)(1),[G,_]=(0,l.useState)("");(0,l.useEffect)(()=>{F()},[E]);let F=async()=>{try{let[e,s,a]=await Promise.all([fetch("/api/sales?".concat(new URLSearchParams(E))),fetch("/api/parts?limit=1000"),fetch("/api/auth/me")]);if(e.ok){let s=await e.json();t(s.data)}if(s.ok){let e=await s.json();p(e.data.filter(e=>e.stock>0))}if(a.ok){let e=await a.json();j(e.data)}}catch(e){console.error("Error fetching data:",e)}finally{N(!1)}},O=async e=>{if(e.preventDefault(),z({}),0===S.items.length){z({general:"Adicione pelo menos um item \xe0 venda"});return}try{let e=await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)}),t=await e.json();e.ok?(f(!1),V(),F()):z({general:t.error||"Erro ao criar venda"})}catch(e){z({general:"Erro de conex\xe3o"})}},R=e=>{D(t=>({...t,items:t.items.filter((t,s)=>s!==e)}))},V=()=>{D({customerName:"",customerEmail:"",customerPhone:"",customerDocument:"",discount:"",paymentMethod:"",notes:"",items:[]}),z({}),T(""),q(1),_("")},L=e=>{D(t=>({...t,[e.target.name]:e.target.value}))},Z=e=>{P(e),w(!0)};if(y)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});let Q=[{value:"CASH",label:"Dinheiro"},{value:"CREDIT_CARD",label:"Cart\xe3o de Cr\xe9dito"},{value:"DEBIT_CARD",label:"Cart\xe3o de D\xe9bito"},{value:"PIX",label:"PIX"},{value:"BANK_TRANSFER",label:"Transfer\xeancia"},{value:"CHECK",label:"Cheque"}];return(0,a.jsx)(i.A,{user:g,children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Vendas"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Gerencie as vendas e or\xe7amentos"})]}),(0,a.jsxs)(r.z,{onClick:()=>f(!0),children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 mr-2"}),"Nova Venda"]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)(n.I,{placeholder:"Buscar vendas...",value:E.search,onChange:e=>k(t=>({...t,search:e.target.value}))}),(0,a.jsx)(d.P,{options:[{value:"PENDING",label:"Pendente"},{value:"CONFIRMED",label:"Confirmado"},{value:"DELIVERED",label:"Entregue"},{value:"CANCELLED",label:"Cancelado"}],value:E.status,onChange:e=>k(t=>({...t,status:e.target.value}))}),(0,a.jsx)(d.P,{options:Q,value:E.paymentMethod,onChange:e=>k(t=>({...t,paymentMethod:e.target.value}))})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Venda"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A\xe7\xf5es"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,a.jsxs)("tr",{className:"table-row",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.Z,{className:"w-8 h-8 text-gray-400 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:["#",e.saleNumber]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.items.length," itens"]})]})]})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm text-gray-900",children:e.customerName||"Cliente n\xe3o informado"}),e.customerPhone&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.customerPhone})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,m.xG)(Number(e.total))}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat((0,m.z2)(e.status)),children:(0,m.li)(e.status)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,m.o0)(e.createdAt)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)(r.z,{variant:"outline",size:"sm",onClick:()=>Z(e),children:(0,a.jsx)(h,{className:"w-4 h-4"})})})]},e.id))})]})})}),(0,a.jsx)(c.u,{isOpen:v,onClose:()=>{f(!1),V()},title:"Nova Venda",size:"xl",children:(0,a.jsxs)("form",{onSubmit:O,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Dados do Cliente"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(n.I,{label:"Nome",name:"customerName",value:S.customerName,onChange:L}),(0,a.jsx)(n.I,{label:"Email",name:"customerEmail",type:"email",value:S.customerEmail,onChange:L}),(0,a.jsx)(n.I,{label:"Telefone",name:"customerPhone",value:S.customerPhone,onChange:L}),(0,a.jsx)(n.I,{label:"CPF/CNPJ",name:"customerDocument",value:S.customerDocument,onChange:L})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Itens da Venda"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)(d.P,{label:"Pe\xe7a",options:s.map(e=>({value:e.id,label:"".concat(e.name," (").concat(e.code,") - Estoque: ").concat(e.stock)})),value:A,onChange:e=>{T(e.target.value);let t=s.find(t=>t.id===e.target.value);t&&_(t.price.toString())}}),(0,a.jsx)(n.I,{label:"Quantidade",type:"number",min:"1",value:M,onChange:e=>q(parseInt(e.target.value))}),(0,a.jsx)(n.I,{label:"Pre\xe7o",type:"number",step:"0.01",value:G,onChange:e=>_(e.target.value)}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsx)(r.z,{type:"button",onClick:()=>{if(!A||!G)return;let e=s.find(e=>e.id===A);if(!e)return;if(M>e.stock){z({item:"Quantidade maior que o estoque dispon\xedvel"});return}let t={partId:A,quantity:M,price:parseFloat(G),discount:0};D(e=>({...e,items:[...e.items,t]})),T(""),q(1),_(""),z({})},className:"w-full",children:"Adicionar"})})]}),I.item&&(0,a.jsx)("p",{className:"text-red-600 text-sm mt-2",children:I.item})]}),S.items.length>0&&(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Pe\xe7a"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Qtd"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Pre\xe7o"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"A\xe7\xf5es"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:S.items.map((e,t)=>{let l=s.find(t=>t.id===e.partId);return(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900",children:[null==l?void 0:l.name," (",null==l?void 0:l.code,")"]}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:e.quantity}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:(0,m.xG)(e.price)}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:(0,m.xG)(e.quantity*e.price)}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:(0,a.jsx)(r.z,{type:"button",variant:"danger",size:"sm",onClick:()=>R(t),children:(0,a.jsx)(u.Z,{className:"w-4 h-4"})})})]},t)})})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Pagamento"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(n.I,{label:"Desconto",name:"discount",type:"number",step:"0.01",value:S.discount,onChange:L}),(0,a.jsx)(d.P,{label:"Forma de Pagamento",name:"paymentMethod",options:Q,value:S.paymentMethod,onChange:L})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(n.I,{label:"Observa\xe7\xf5es",name:"notes",value:S.notes,onChange:L})})]}),(0,a.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["Total: ",(0,m.xG)(S.items.reduce((e,t)=>e+(t.quantity*t.price-(t.discount||0)),0)-(parseFloat(S.discount)||0))]})})}),I.general&&(0,a.jsx)("div",{className:"text-red-600 text-sm",children:I.general}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)(r.z,{type:"button",variant:"secondary",onClick:()=>{f(!1),V()},children:"Cancelar"}),(0,a.jsx)(r.z,{type:"submit",children:"Criar Venda"})]})]})}),(0,a.jsx)(c.u,{isOpen:b,onClose:()=>{w(!1),P(null)},title:"Venda #".concat(null==C?void 0:C.saleNumber),size:"lg",children:C&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Dados do Cliente"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Nome:"})," ",C.customerName||"N\xe3o informado"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Email:"})," ",C.customerEmail||"N\xe3o informado"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Telefone:"})," ",C.customerPhone||"N\xe3o informado"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Status:"})," ",(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat((0,m.z2)(C.status)),children:(0,m.li)(C.status)})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Itens"}),(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Pe\xe7a"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Qtd"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Pre\xe7o"}),(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:C.items.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900",children:[e.part.name," (",e.part.code,")"]}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:e.quantity}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:(0,m.xG)(Number(e.price))}),(0,a.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:(0,m.xG)(Number(e.total))})]},e.id))})]})})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Forma de Pagamento:"})," ",C.paymentMethod?(0,m.vw)(C.paymentMethod):"N\xe3o informado"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Data:"})," ",(0,m.o0)(C.createdAt)]})]}),(0,a.jsx)("div",{className:"mt-4 text-right",children:(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["Total: ",(0,m.xG)(Number(C.total))]})})]})]})})]})})}},6819:function(e,t,s){"use strict";s.d(t,{P:function(){return i}});var a=s(7437);s(2265);var l=s(3448);let i=e=>{let{label:t,error:s,helperText:i,options:r,className:n,id:d,...c}=e,m=d||(null==t?void 0:t.toLowerCase().replace(/\s+/g,"-"));return(0,a.jsxs)("div",{className:"space-y-1",children:[t&&(0,a.jsx)("label",{htmlFor:m,className:"block text-sm font-medium text-gray-700",children:t}),(0,a.jsxs)("select",{id:m,className:(0,l.cn)("input-field",s&&"border-red-300 focus:ring-red-500",n),...c,children:[(0,a.jsx)("option",{value:"",children:"Selecione..."}),r.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]}),s&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:s}),i&&!s&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:i})]})}}},function(e){e.O(0,[157,166,971,117,744],function(){return e(e.s=2450)}),_N_E=e.O()}]);